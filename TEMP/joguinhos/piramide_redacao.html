<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Pir√¢mide da Reda√ß√£o - Redaction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            overflow-y: hidden; 
        }
        #main-content {
            height: calc(100vh - 5rem); /* 5rem = altura do header (h-20) */
            overflow-y: auto; 
        }
        /* Estilos para arrastar e soltar */
        .draggable-block {
            cursor: grab;
            user-select: none; /* Evita sele√ß√£o de texto ao arrastar */
            transition: all 0.2s ease-in-out;
        }
        .draggable-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .draggable-block.dragging {
            opacity: 0.6;
            cursor: grabbing;
            border: 2px dashed #C4B5FD;
        }
        .drop-zone {
            min-height: 250px; /* Altura m√≠nima para a √°rea de soltar */
            border: 2px dashed #A78BFA; /* Borda tracejada */
        }
        .drop-zone.highlight {
            background-color: rgba(167, 139, 250, 0.1); /* Cor de destaque ao arrastar sobre */
        }
    </style>
</head>
<body class="bg-[#2A0F5E] text-[#E8E1CF] font-sans">

    <header class="bg-[#3D1E8D] h-20 shadow-md flex justify-between items-center px-6 sm:px-8 lg:px-12">
        <div class="flex items-center space-x-4 md:space-x-5">
            <a href="./index.html" class="text-[#E8E1CF] hover:opacity-75"> 
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                </svg>
            </a>
            <img src="../logo.png" alt="Redaction" class="h-10 sm:h-12">
        </div>
        
        <div class="flex items-center space-x-4 sm:space-x-6">
            <div class="flex flex-col items-end text-right">
                <p class="text-sm sm:text-base font-semibold text-[#E8E1CF] whitespace-nowrap">
                    Pontos: <span id="currentPointsHeader">850</span> XP ‚ú®
                </p>
                <div class="w-24 sm:w-32 bg-[#2A0F5E] rounded-full h-1.5 mt-0.5">
                    <div class="bg-[#A78BFA] h-1.5 rounded-full" style="width: 85%"></div> 
                </div>
            </div>

            <a href="#" class="text-sm text-[#E8E1CF] hover:opacity-75 hidden sm:block">Sair</a>
            <a href="../CONFIGURACOES/index.html" class="w-9 h-9 bg-[#2A0F5E] rounded-full flex items-center justify-center ring-2 ring-[#5A3E9D] hover:ring-white transition-all duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#E8E1CF" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                </svg>
            </a>
        </div>
    </header>

    <main
        id="main-content"
        class="bg-no-repeat bg-cover bg-center"
        style="background-image: url('../fundo-temas.png');">
        
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-16">

            <div class="max-w-4xl mx-auto mb-8 md:mb-12 text-center">
                <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 leading-tight text-[#E8E1CF]">
                    Pir√¢mide da Reda√ß√£o üî∫
                </h1>
                <p class="text-lg text-[#E8E1CF] opacity-90">Organize os blocos de texto na ordem correta de uma reda√ß√£o completa!</p>
                <hr class="border-t-2 border-[#E8E1CF] opacity-50 w-32 mx-auto mt-4">
            </div>

            <div class="max-w-4xl mx-auto bg-[#3D1E8D] p-6 rounded-xl shadow-lg">
                <div id="instructions" class="mb-6 text-center text-lg text-[#E8E1CF]">
                    <p><strong>Desafio 1:</strong> Monte a estrutura b√°sica de uma reda√ß√£o do ENEM.</p>
                </div>

                <div id="blockBank" class="flex flex-wrap justify-center gap-4 p-4 bg-[#2A0F5E] rounded-lg mb-8">
                    </div>

                <div id="pyramidDropZone" class="drop-zone flex flex-col items-center gap-2 p-4 bg-[#2A0F5E] rounded-lg mb-8">
                    <p class="text-[#E8E1CF] opacity-70 italic" id="dropPlaceholder">Arraste os blocos aqui para montar a reda√ß√£o...</p>
                </div>

                <div class="flex justify-center gap-4">
                    <button id="checkButton" 
                            class="bg-[#A78BFA] text-[#2A0F5E] font-bold py-3 px-6 rounded-lg shadow-md hover:bg-[#C4B5FD] transition-all duration-200 ease-in-out">
                        Verificar Ordem
                    </button>
                    <button id="nextChallengeButton" 
                            class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-700 transition-all duration-200 ease-in-out"
                            style="display: none;">
                        Pr√≥ximo Desafio
                    </button>
                    <button id="resetButton" 
                            class="bg-gray-600 text-[#E8E1CF] font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-700 transition-all duration-200 ease-in-out">
                        Reiniciar
                    </button>
                </div>

                <div id="feedback" class="mt-6 p-4 rounded-lg text-center text-xl font-bold" style="display: none;">
                    </div>
            </div>
        </div>
    </main>

    <script>
        const blockBank = document.getElementById('blockBank');
        const pyramidDropZone = document.getElementById('pyramidDropZone');
        const dropPlaceholder = document.getElementById('dropPlaceholder');
        const checkButton = document.getElementById('checkButton');
        const nextChallengeButton = document.getElementById('nextChallengeButton');
        const resetButton = document.getElementById('resetButton');
        const feedback = document.getElementById('feedback');
        const instructions = document.getElementById('instructions');

        // Pontos no cabe√ßalho (mantido do seu c√≥digo original)
        const currentPointsHeader = document.getElementById('currentPointsHeader');
        let userPoints = parseInt(currentPointsHeader.innerText); 

        // --- Dados do Jogo (Desafios) ---
        const challenges = [
            {
                id: 1,
                prompt: "Monte a estrutura b√°sica de uma reda√ß√£o dissertativo-argumentativa.",
                blocks: [
                    { id: 'intro', text: 'Apresenta√ß√£o do tema e tese.', type: 'Introdu√ß√£o' },
                    { id: 'dev1', text: 'Argumento 1 e seu desenvolvimento.', type: 'Desenvolvimento 1' },
                    { id: 'dev2', text: 'Argumento 2 e seu desenvolvimento.', type: 'Desenvolvimento 2' },
                    { id: 'conc', text: 'Retomada da tese e proposta de interven√ß√£o.', type: 'Conclus√£o' }
                ],
                correctOrder: ['intro', 'dev1', 'dev2', 'conc'],
                points: 100,
                explanation: "A estrutura padr√£o de uma reda√ß√£o do ENEM segue a ordem: Introdu√ß√£o (apresenta√ß√£o e tese), Desenvolvimento 1 (primeiro argumento), Desenvolvimento 2 (segundo argumento) e Conclus√£o (retomada da tese e proposta de interven√ß√£o)."
            },
            {
                id: 2,
                prompt: "Organize as partes de uma reda√ß√£o mais detalhada, incluindo o repert√≥rio.",
                blocks: [
                    { id: 'thesis', text: 'Tese e contextualiza√ß√£o inicial.', type: 'Introdu√ß√£o - Tese' },
                    { id: 'arg1_dev', text: 'Desenvolvimento do primeiro argumento e exemplifica√ß√£o.', type: 'Desenvolvimento 1 - Argumento' },
                    { id: 'rep_soc', text: 'Repert√≥rio sociocultural para fundamentar o argumento 1.', type: 'Desenvolvimento 1 - Repert√≥rio' },
                    { id: 'arg2_dev', text: 'Desenvolvimento do segundo argumento com mais dados.', type: 'Desenvolvimento 2 - Argumento' },
                    { id: 'interv', text: 'Proposta de interven√ß√£o completa com agente, a√ß√£o, meio, finalidade e detalhamento.', type: 'Conclus√£o - Proposta' },
                    { id: 'retom', text: 'Retomada da tese e breve s√≠ntese dos argumentos.', type: 'Conclus√£o - Retomada' }
                ],
                // Ordem mais complexa: Tese -> Repert√≥rio -> Arg1 -> Arg2 -> Retomada -> Interven√ß√£o
                correctOrder: ['thesis', 'rep_soc', 'arg1_dev', 'arg2_dev', 'retom', 'interv'], 
                points: 150,
                explanation: "Uma reda√ß√£o detalhada geralmente come√ßa com a tese, seguida pelo repert√≥rio que fundamenta o primeiro argumento, depois o desenvolvimento dos argumentos e, por fim, a conclus√£o com retomada da tese e uma proposta de interven√ß√£o detalhada."
            }
            // Adicione mais desafios aqui, com diferentes n√≠veis de complexidade
        ];

        let currentChallengeIndex = 0;
        let currentChallenge;

        function loadChallenge() {
            if (currentChallengeIndex >= challenges.length) {
                displayCompletionMessage();
                return;
            }

            currentChallenge = challenges[currentChallengeIndex];
            instructions.innerHTML = `<p><strong>Desafio ${currentChallenge.id}:</strong> ${currentChallenge.prompt}</p>`;
            
            // Limpa as √°reas
            blockBank.innerHTML = '';
            pyramidDropZone.innerHTML = '';
            dropPlaceholder.style.display = 'block'; // Mostra o placeholder
            feedback.style.display = 'none'; // Esconde o feedback
            feedback.className = 'mt-6 p-4 rounded-lg text-center text-xl font-bold'; // Reseta a classe
            nextChallengeButton.style.display = 'none'; // Esconde o bot√£o de pr√≥ximo
            checkButton.style.display = 'block'; // Mostra o bot√£o de verificar

            // Embaralha os blocos e os adiciona ao banco
            const shuffledBlocks = [...currentChallenge.blocks].sort(() => Math.random() - 0.5);
            shuffledBlocks.forEach(blockData => {
                const blockElement = document.createElement('div');
                blockElement.classList.add('draggable-block', 'bg-[#A78BFA]', 'text-[#2A0F5E]', 'p-4', 'rounded-lg', 'shadow-md', 'font-semibold', 'text-center', 'w-full', 'md:w-64');
                blockElement.innerText = blockData.text;
                blockElement.setAttribute('draggable', 'true');
                blockElement.dataset.id = blockData.id; // Armazena o ID para verifica√ß√£o
                blockElement.title = blockData.type; // Dica ao passar o mouse
                blockBank.appendChild(blockElement);
            });

            addDragAndDropListeners();
        }

        function addDragAndDropListeners() {
            const draggables = document.querySelectorAll('.draggable-block');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', () => {
                    draggable.classList.add('dragging');
                });

                draggable.addEventListener('dragend', () => {
                    draggable.classList.remove('dragging');
                });
            });

            // Permite soltar na drop zone
            pyramidDropZone.addEventListener('dragover', e => {
                e.preventDefault(); // Permite que o elemento seja solto
                pyramidDropZone.classList.add('highlight'); // Destaca a √°rea de soltar
                const afterElement = getDragAfterElement(pyramidDropZone, e.clientY);
                const draggable = document.querySelector('.dragging');
                if (afterElement == null) {
                    pyramidDropZone.appendChild(draggable);
                } else {
                    pyramidDropZone.insertBefore(draggable, afterElement);
                }
                // Esconde o placeholder se houver itens
                if (pyramidDropZone.children.length > 0 && dropPlaceholder.style.display !== 'none') {
                    dropPlaceholder.style.display = 'none';
                }
            });

            pyramidDropZone.addEventListener('dragleave', () => {
                pyramidDropZone.classList.remove('highlight'); // Remove destaque ao sair
            });

            pyramidDropZone.addEventListener('drop', e => {
                e.preventDefault();
                pyramidDropZone.classList.remove('highlight'); // Remove destaque ao soltar
                const draggable = document.querySelector('.dragging');
                if (draggable) {
                    // J√° foi anexado via dragover
                    // Esconde o placeholder se houver itens
                    if (pyramidDropZone.children.length > 0 && dropPlaceholder.style.display !== 'none') {
                        dropPlaceholder.style.display = 'none';
                    }
                }
            });

            // Permite arrastar de volta para o banco de blocos
            blockBank.addEventListener('dragover', e => {
                e.preventDefault();
                blockBank.classList.add('highlight');
            });
            blockBank.addEventListener('dragleave', () => {
                blockBank.classList.remove('highlight');
            });
            blockBank.addEventListener('drop', e => {
                e.preventDefault();
                blockBank.classList.remove('highlight');
                const draggable = document.querySelector('.dragging');
                if (draggable) {
                    blockBank.appendChild(draggable);
                    // Mostra o placeholder se a dropZone estiver vazia e o placeholder estiver oculto
                    if (pyramidDropZone.children.length === 1 && pyramidDropZone.children[0] === dropPlaceholder) {
                        dropPlaceholder.style.display = 'block';
                    }
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.draggable-block:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: -Infinity }).element;
        }

        checkButton.addEventListener('click', () => {
            const currentOrderIds = Array.from(pyramidDropZone.children)
                                    .filter(el => el !== dropPlaceholder) // Ignora o placeholder
                                    .map(el => el.dataset.id);
            
            const isCorrect = JSON.stringify(currentOrderIds) === JSON.stringify(currentChallenge.correctOrder);

            if (isCorrect) {
                userPoints += currentChallenge.points; 
                currentPointsHeader.innerText = userPoints;

                feedback.style.display = 'block';
                feedback.className = 'mt-6 p-4 rounded-lg text-center text-xl font-bold bg-green-500 text-white';
                feedback.innerHTML = `üéâ **Parab√©ns! Ordem Correta!**<br> ${currentChallenge.explanation} +${currentChallenge.points} XP`;
                
                checkButton.style.display = 'none';
                nextChallengeButton.style.display = 'block';

            } else {
                feedback.style.display = 'block';
                feedback.className = 'mt-6 p-4 rounded-lg text-center text-xl font-bold bg-red-500 text-white';
                feedback.innerHTML = `‚ùå Ops! A ordem est√° incorreta. Revise a estrutura da reda√ß√£o.<br><em>${currentChallenge.explanation}</em>`;
            }
        });

        nextChallengeButton.addEventListener('click', () => {
            currentChallengeIndex++;
            loadChallenge();
        });

        resetButton.addEventListener('click', () => {
            loadChallenge(); // Recarrega o desafio atual
        });

        function displayCompletionMessage() {
            const finalMessage = document.createElement('div');
            finalMessage.className = 'text-3xl font-bold text-center text-[#E8E1CF]';
            finalMessage.innerHTML = `<p>üéâ Incr√≠vel! Voc√™ montou todas as reda√ß√µes e dominou a estrutura!</p><p class="mt-4">Sua pontua√ß√£o final: ${userPoints} XP</p>`;
            
            // Limpa o conte√∫do principal e adiciona a mensagem final
            document.querySelector('.max-w-4xl.mx-auto.bg-\\[\\#3D1E8D\\]').innerHTML = ''; 
            document.querySelector('.max-w-4xl.mx-auto.bg-\\[\\#3D1E8D\\]').appendChild(finalMessage);

            instructions.style.display = 'none';
            feedback.style.display = 'none';
            checkButton.style.display = 'none';
            nextChallengeButton.style.display = 'none';
            resetButton.style.display = 'none';
        }

        // Carrega o primeiro desafio ao carregar a p√°gina
        loadChallenge();
    </script>
</body>
</html>