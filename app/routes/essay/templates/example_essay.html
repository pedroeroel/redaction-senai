{% extends 'layout.html' %}
{% block pagename %}Exemplo de Redação — Nota 900+{% endblock %}
{% block pagetext %}Modelo de redação com desempenho excelente (900+){% endblock %}
{% set main = True %}
{% set header = True %}
{% set footer = True %}

{% block content %}
<div class="max-w-4xl mx-auto p-6 text-white">

    <!-- HEADER -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-4xl font-bold">{{ essay.title }}</h1>
            <p class="text-sm text-gray-300 mt-1">
                Tema:
                <span class="font-semibold text-gray-200">
                    {{ essay.theme }}
                </span>
            </p>
        </div>

        <a href="{{ url_for('essay.examples') }}"
           class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg shadow transition font-semibold">
            ← voltar
        </a>
    </div>

    <!-- SAMPLE BADGE -->
    <div class="flex items-center gap-4 mb-6">
        <div class="rounded-full bg-amber-500 text-black px-3 py-1 font-bold">Exemplo</div>
        <div class="rounded-full bg-emerald-600 px-3 py-1 font-bold shadow">
            Nota: {{ essay.grade }}/1000
        </div>
        <div class="text-sm text-gray-300">Desempenho: Excelente (900+)</div>
    </div>

    <!-- ESSAY CARD -->
    <div class="bg-[#3b2a52] p-6 rounded-xl shadow-lg mb-8">
        <div class="bg-[#2a1d3b] p-5 rounded-lg border border-white/10 max-h-96 overflow-y-auto whitespace-pre-wrap text-gray-100 leading-relaxed">
            {{ essay.content }}
        </div>
    </div>

    <!-- ANALYSIS -->
    <div class="bg-[#3b2a52] p-6 rounded-xl shadow-lg">

        <div class="flex justify-between items-center border-b border-white/20 pb-4 mb-6">
            <h2 class="text-2xl font-bold">Análise técnica — Exemplo Modelo</h2>
            <div class="text-3xl bg-emerald-600 px-4 py-2 rounded-lg font-extrabold shadow">
                {{ essay.grade }}/1000
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

            <!-- CHART -->
            <div class="flex justify-center items-center">
                <canvas id="exampleCompetencyChart" width="300" height="300"></canvas>
            </div>

            <!-- COMMENTS -->
            <div>
                <h3 class="text-xl font-bold mb-4">Comentários por Competência</h3>

                {% for score in essay.competencies %}
                <div class="bg-[#2a1d3b] p-4 rounded-lg border-l-4 border-emerald-400 mb-3">
                    <p class="font-bold text-white">
                        Competência {{ loop.index }}:
                        <span class="text-emerald-300">{{ score }}/200</span>
                    </p>

                    <p class="mt-2 text-gray-300">
                        {{ essay.comments[loop.index0] }}
                    </p>
                </div>
                {% endfor %}

                <!-- General Comment -->
                <div class="bg-[#2a1d3b] p-4 rounded-lg border-l-4 border-purple-400 mt-6">
                    <p class="font-bold text-white">Comentário geral</p>
                    <p class="mt-2 text-gray-300">
                        {{ essay.comments[5] }}
                    </p>
                </div>

            </div>

        </div>
    </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const competencies = {{ essay.competencies | tojson }};

    new Chart(document.getElementById('exampleCompetencyChart'), {
        type: 'pie',
        data: {
            labels: [
                "Competência 1",
                "Competência 2",
                "Competência 3",
                "Competência 4",
                "Competência 5"
            ],
            datasets: [{
                data: competencies,
                borderWidth: 2,
                backgroundColor: [
                    "#10b981",
                    "#3b82f6",
                    "#f59e0b",
                    "#ef4444",
                    "#a855f7"
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: "bottom",
                    labels: { color: "white" }
                },
                tooltip: {
                    callbacks: {
                        label: (context) => context.label + ": " + context.parsed + "/200"
                    }
                }
            }
        }
    });
</script>
{% endblock %}
