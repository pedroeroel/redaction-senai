{% extends "layout.html" %}
{% set main = True %}
{% block pagename %}Resultado da Redação{% endblock %}

{% block content %}

<div class="max-w-4xl mx-auto p-6 text-white">

    <h1 class="text-4xl font-bold mb-6 text-center">Resultado da Redação</h1>

    <!-- GENERAL GRADE -->
    <div class="bg-[#3b2a52] p-6 rounded-xl mb-6 shadow-md">
        <h2 class="text-2xl font-bold mb-2">Nota Geral</h2>
        <p class="text-3xl text-emerald-300 font-bold">{{ results.generalGrade }}/1000</p>
    </div>

    <!-- COMPETENCIES + PIE CHART -->
    <div class="bg-[#3b2a52] p-6 rounded-xl mb-6 shadow-md">

        <h2 class="text-2xl font-bold mb-4">Competências</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <!-- CHART -->
            <div class="flex justify-center items-center">
                <canvas id="competencyChart" width="300" height="300"></canvas>
            </div>

            <!-- VALUES -->
            <div class="space-y-4">

                {% for score in results.competencies %}
                <div class="p-4 rounded-lg bg-[#2a1d3b] flex justify-between">
                    <p class="font-bold">Competência {{ loop.index }}</p>
                    <p class="text-xl text-emerald-300">{{ score }}/200</p>
                </div>
                {% endfor %}

            </div>

        </div>
    </div>

    <!-- COMMENTS -->
    <div class="bg-[#3b2a52] p-6 rounded-xl mb-6 shadow-md">
        <h2 class="text-2xl font-bold mb-4">Comentários do Avaliador</h2>

        <ul class="list-disc ml-6 space-y-3">
            {% for comment in results.comments %}
            <li class="text-lg">{{ comment }}</li>
            {% endfor %}
        </ul>
    </div>

    <!-- BUTTONS -->
    <form action="/handle_essay_action" method="POST" class="flex gap-4 justify-center mt-8">

        <button
            name="action"
            value="dismiss"
            class="px-6 py-3 bg-red-600 hover:bg-red-700 rounded-xl text-lg font-bold transition">
            Descartar Redação
        </button>

        <button
            name="action"
            value="save"
            class="px-6 py-3 bg-emerald-600 hover:bg-emerald-700 rounded-xl text-lg font-bold transition">
            Salvar Redação
        </button>

    </form>

</div>

<!-- CHART.JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Convert Python list to JS list
    const competencies = {{ results.competencies | tojson }};

    const ctx = document.getElementById('competencyChart');

    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: [
                'Competência 1',
                'Competência 2',
                'Competência 3',
                'Competência 4',
                'Competência 5'
            ],
            datasets: [{
                data: competencies,
                borderWidth: 2,
                backgroundColor: [
                    '#10b981', // emerald
                    '#3b82f6', // blue
                    '#f59e0b', // amber
                    '#ef4444', // red
                    '#a855f7'  // purple
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: true,
                    position: "bottom",
                    labels: {
                        color: "white"
                    }
                }
            }
        }
    });
</script>

{% endblock %}
